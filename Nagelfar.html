<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Nagelfar - A Tcl Syntax Checker</title>
      
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
</head>
<body>
 
<h1>Nagelfar - A Tcl Syntax checker</h1>
<a href="#NagelfarDownload">Download</a>
<a href="#NagelfarFeatures">Features</a>
<a href="#NagelfarChanges">Changes</a>
<p>
<h3>About Nagelfar</h3>
In 1999 I got an idea about how I wanted a syntax checker to work,
and that led to a couple of evenings of massive hacking.  After that
it mainly collected dust for a few years before it caught my interest
again.  This had a lot to do with a synthesis script crashing due to
a misspelled variable after running for 30 hours.<br>
After some regular usage by me it is getting stable and can catch a lot
of common errors.
<p>
Any feedback, good or bad, can be sent to
&lt;peter <i>dot</i> spjuth <i>at</i> space <i>dot</i> se&gt;
<p>
<a href="http://wiki.tcl.tk/StaticSyntaxAnalysis">See also this page for other syntax checkers.</a>
<br>

<a name="NagelfarFeatures"></a><h3>Features</h3>
<ul>
  <li>Written in pure Tcl/Tk.  No compilation. If you can run Tcl you can run
      Nagelfar.</li>
  <li>Extendible.  You can add to the syntax database, or let the tool use
      Tcl's introspection to extract syntax information from any Tcl
      interpreter.  Thus you can test scripts for applications using Tcl as
      script language.</li>
  <li>It is picky. It prefers to warn if it is uncertain.</li>
  <li>Severity level filter and glob matching filters to remove errors
      known to be ok.</li>
</ul>

To get a feeling of what it can do, here is a test script that is part of 
the distribution with errors it can detect, and the output from the tool.
<br>

<pre>
<span style="color: #808080">  1</span>  proc apa {} {
<span style="color: #808080">  2</span>  
<span style="color: #808080">  3</span>      set bepa 1
<span style="color: #808080">  4</span>      <span style="color: #b22222"># Detect missing $</span>
<span style="color: #808080">  5</span>      set cepa bepa
<span style="color: #808080">  6</span>      <span style="color: #b22222"># Detect unknown or misspelled variable</span>
<span style="color: #808080">  7</span>      set depa $cep
<span style="color: #808080">  8</span>      set epa
<span style="color: #808080">  9</span>      <span style="color: #b22222"># Detect bad $</span>
<span style="color: #808080"> 10</span>      set $depa apa
<span style="color: #808080"> 11</span>      if {[info exists $cepa]} {
<span style="color: #808080"> 12</span>          <span style="color: #b22222"># Detect wrong number of args</span>
<span style="color: #808080"> 13</span>          set apa bepa cepa
<span style="color: #808080"> 14</span>      }
<span style="color: #808080"> 15</span>      <span style="color: #b22222"># Detect ugly if</span>
<span style="color: #808080"> 16</span>      if {$bepa == $cepa} {
<span style="color: #808080"> 17</span>          set hej 1
<span style="color: #808080"> 18</span>      } elsif {$bepa == $cepa} {
<span style="color: #808080"> 19</span>          set hej 2
<span style="color: #808080"> 20</span>      } else {
<span style="color: #808080"> 21</span>          set hej 3
<span style="color: #808080"> 22</span>      }
<span style="color: #808080"> 23</span>      <span style="color: #b22222"># Detect bad subcommand</span>
<span style="color: #808080"> 24</span>      info gurka
<span style="color: #808080"> 25</span>  
<span style="color: #808080"> 26</span>      <span style="color: #b22222"># Detect bad switch comment</span>
<span style="color: #808080"> 27</span>      switch $bepa {
<span style="color: #808080"> 28</span>          hej {
<span style="color: #808080"> 29</span>              set hej hopp
<span style="color: #808080"> 30</span>          }
<span style="color: #808080"> 31</span>          <span style="color: #b22222"># This is bad</span>
<span style="color: #808080"> 32</span>          hopp {
<span style="color: #808080"> 33</span>              <span style="color: #b22222"># Detect a missing command</span>
<span style="color: #808080"> 34</span>              miffo
<span style="color: #808080"> 35</span>          }
<span style="color: #808080"> 36</span>      }
<span style="color: #808080"> 37</span>  }
<span style="color: #808080"> 38</span>  
<span style="color: #808080"> 39</span>  <span style="color: #b22222"># Test call-by-name handling</span>
<span style="color: #808080"> 40</span>  <span style="color: #b22222"># The syntax of this proc is described in the file test.syntax</span>
<span style="color: #808080"> 41</span>  proc copy {srcName dstName} {
<span style="color: #808080"> 42</span>      upvar $srcName src $dstName dst
<span style="color: #808080"> 43</span>      set dst $src
<span style="color: #808080"> 44</span>  }
<span style="color: #808080"> 45</span>  
<span style="color: #808080"> 46</span>  proc testCopy {} {
<span style="color: #808080"> 47</span>      set apa 1
<span style="color: #808080"> 48</span>      <span style="color: #b22222"># It should not warn about apa below</span>
<span style="color: #808080"> 49</span>      copy apa bepa
<span style="color: #808080"> 50</span>      <span style="color: #b22222"># Bepa should be known now</span>
<span style="color: #808080"> 51</span>      set cepa $bepa
<span style="color: #808080"> 52</span>  
<span style="color: #808080"> 53</span>      <span style="color: #b22222"># Detect $ mistake</span>
<span style="color: #808080"> 54</span>      copy apa $bepa
<span style="color: #808080"> 55</span>      copy $apa bepa
<span style="color: #808080"> 56</span>  }
<span style="color: #808080"> 57</span>  
<span style="color: #808080"> 58</span>  proc bepa {} {
<span style="color: #808080"> 59</span>      <span style="color: #b22222"># Missing quote</span>
<span style="color: #808080"> 60</span>      set apa "hej hopp
<span style="color: #808080"> 61</span>  }
<span style="color: #808080"> 62</span>  <span style="color: #b22222"># A quote just to fix syntax coloring "</span>
<span style="color: #808080"> 63</span>  
<span style="color: #808080"> 64</span>  proc cepa {} {
<span style="color: #808080"> 65</span>      <span style="color: #b22222"># Missing bracket</span>
<span style="color: #808080"> 66</span>      set apa [hej hopp
<span style="color: #808080"> 67</span>  }
<span style="color: #808080"> 68</span>  
<span style="color: #808080"> 69</span>  proc epa {} {
<span style="color: #808080"> 70</span>      <span style="color: #b22222"># Extra close brace</span>
<span style="color: #808080"> 71</span>      if {[string length apa}} {
<span style="color: #808080"> 72</span>          set bepa 1
<span style="color: #808080"> 73</span>      }
<span style="color: #808080"> 74</span>  }
<span style="color: #808080"> 75</span>  
<span style="color: #808080"> 76</span>  <span style="color: #b22222"># This should be last in the file, since the missing close brace</span>
<span style="color: #808080"> 77</span>  <span style="color: #b22222"># disturbs anything after it</span>
<span style="color: #808080"> 78</span>  proc depa {} {
<span style="color: #808080"> 79</span>      <span style="color: #b22222"># Missing close brace</span>
<span style="color: #808080"> 80</span>      if {[string length apa] {
<span style="color: #808080"> 81</span>          set bepa 1
<span style="color: #808080"> 82</span>      }
<span style="color: #808080"> 83</span>  }
</pre>
<br><br>
The result of checking the above is:
<br><br>
<pre>
Parsing file tests/test.syntax
Checking file tests/test.tcl
Line   5: W Found constant "bepa" which is also a variable.
Line   7: E Unknown variable "cep"
Line   8: E Unknown variable "epa"
Line  10: N Suspicious variable name "$depa"
Line  11: N Suspicious variable name "$cepa"
Line  13: E Wrong number of arguments (3) to "set"
Line  13: W Found constant "bepa" which is also a variable.
Line  13: W Found constant "cepa" which is also a variable.
Line  18: E Badly formed if statement
            Found argument 'elsif' where else/elseif was expected.
Line  24: E Unknown subcommand "gurka" to "info"
Line  31: W Switch pattern starting with #. This could be a bad comment.
Line  31: W Unknown command "This"
Line  31: W Unknown command "bad"
Line  34: W Unknown command "miffo"
Line  54: N Suspicious variable name "$bepa"
Line  55: N Suspicious variable name "$apa"
Line  60: E Could not complete statement.
            One double quote would complete the first line
            One double quote would complete the script body at line 61.
Line  66: E Could not complete statement.
            One close bracket would complete the first line
            One close bracket would complete the script body at line 67.
Line  69: E Wrong number of arguments (4) to "proc"
            Argument 4 at line 71
Line  73: N Close brace not aligned with line 69 (0 4)
Line  74: E Close brace first in statement.
Line  74: W Unknown command "}"
Line  78: E Could not complete statement.
            One close brace would complete the first line
            One close brace would complete the script body at line 84.
            Assuming completeness for further processing.
Line  80: E Wrong number of arguments (1) to "if"
Line  83: N Found non indented close brace that did not end statement.
            This may indicate a brace mismatch.
Line  83: N Close brace not aligned with line 80 (4 0)
</pre>

<a name="NagelfarDownload"></a><h3>Download</h3>

Nagelfar requires Tcl/Tk 8.4 to run. The licence is GPL.<br>
Version 1.0b1:<br>
<a href="nagelfar/nagelfar10.tar.gz">Main distribution</a><br>
<a href="nagelfar/nagelfar.kit">Starkit</a><br>
<a href="nagelfar/nagelfar">Starpack for Linux (x86)</a><br>
<a href="nagelfar/nagelfar.solaris">Starpack for Solaris (sparc)</a><br>
<a href="nagelfar/nagelfar.exe">Starpack for Windows</a><br>

<a name="NagelfarChanges"></a><h3>Changes</h3>
Changes in v1.0b1 (2004-01-29):<br>
<ul>
  <li> Recognise if 0 {...} as a comment.</li>
  <li> Added a check for bad comments in constant lists.</li>
  <li> Added a 2-pass proc checking to improve things when procs are used
       before they are defined in a file.</li>
  <li> Optimised, improved speed by about 35%.</li>
</ul>
<br>
Changes in v0.9 (2003-12-11):<br>
<ul>
  <li> Improved expression checking.</li>
  <li> Added upvar detection to handle call-by-name better.</li>
  <li> Added a check in the edit window to simplify checking of clips
       that are not in files.</li>
</ul>
<br>
Changes in v0.8 (2003-08-14):<br>
<ul>
  <li> Bugfixes in options checking and proc checking.</li>
  <li> GUI polishing.</li>
</ul>
<br>
Changes in v0.7 (2003-07-23):<br>
<ul>
  <li> Tclkit support. Removed FreeWrap support.</li>
  <li> Requires Tcl/Tk 8.4.</li>
  <li> More knowledge about options in syntax databases.</li>
  <li> Some GUI polish including a progress bar and context menu.</li>
  <li> Fixed a bug where the script's own procs were not checked properly.</li>
  <li> Added a severity level to each message (Note/Warning/Error) and a
       severity level filter on output.</li>
</ul>
<br>
Changes in v0.6 (2003-07-08):<br>
<ul>
  <li> The application got its name.</li>
  <li> Added -filter option to suppress messages.</li>
</ul>
<br>
Changes in v0.5 (2003-02-14):<br>
<ul>
  <li> Made it work when wrapped with FreeWrap.
  This includes wrapping the syntax database and
  supporting <a href="http://sourceforge.net/projects/tkdnd/">TkDnd</a>
  if properly placed.</li>
</ul>
<br>
Changes in v0.4 (2002-11-14):<br>
<ul>
  <li> Added option to skip variable check.</li>
  <li> Added option to enforce 'else' keyword.</li>
  <li> Some message improvements and minor bug fixes.</li>
</ul>
<br>
Changes in v0.3 (2002-09-02):<br>
<ul>
  <li> Made procedure checking namespace-aware.</li>
  <li> Some improvements in syntax database and check engine.</li>
</ul>
<br>
Changes in v0.2 (2002-08-28):<br>
<ul>
  <li>Added a GUI, which can be used if you run with wish or in Tcl8.4.<br>
  It is still a command line tool but invokes the GUI if no arguments are
  given or the option -gui is used.</li>
  <li>Changed how syntax databases are located, which simplifies usage a bit.</li>
  <li>Sorts output on line numbers to make it easier to follow.</li>
  <li>Improved some error messages.</li>
</ul>
 
</body>
</html>
