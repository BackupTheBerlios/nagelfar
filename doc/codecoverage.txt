<ul>Code Coverage</ul>

Nagelfar has support for doing simple code coverage analysis.


Instrument each file:
nagelfar.tcl -instrument apa.tcl

That creates apa.tcl_i

Make your tests run the instrumented file.  If a file is sourced from an
instrumented file, an instrumented version will be read.  Thus only the
top file called from the test needs to be adjusted.

The source under test must terminate using the "exit" command.

Running tests creates apa.tcl_log.
Coverage data is accumulated in the log file so multple tests can
be run.  Make sure the log file is deleted before a rerun.

Create a markup file for displaying result:
nagelfar.tcl -markup apa.tcl

This creates apa.tcl_m. The markup file contains asterisks in blocks
that were not run.

Compare original with markup:

eskil -noparse apa.tcl apa.tcl_m


<ul>Example</ul>

Nagelfar's testsuite has code like this to automatically run the
instrumented file:
    set file nagelfar.tcl
    if {[file exists ${file}_i]} {
        set file ${file}_i
    }

Below is the makefile lines used by Nagelfar to test itself.

# Instrument source file for code coverage
nagelfar.tcl_i: nagelfar.tcl
	@./nagelfar.tcl -instrument nagelfar.tcl

# Target to prepare for code coverage run. Makes sure log file is clear.
instrument: nagelfar.tcl_i
	@rm -f nagelfar.tcl_log

# Run tests to create log file.
nagelfar.tcl_log: nagelfar.tcl_i
	@./tests/all.tcl $(TESTFLAGS)

# Create markup file for better view of result
nagelfar.tcl_m: nagelfar.tcl_log
	@./nagelfar.tcl -markup nagelfar.tcl

# View code coverage result
icheck: nagelfar.tcl_m
	@eskil -noparse ./nagelfar.tcl ./nagelfar.tcl_m &
